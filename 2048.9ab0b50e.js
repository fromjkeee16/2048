!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e=Object.freeze({Start:"start",Restart:"restart",Hidden:"hidden",ActionButton:"button"}),s=Object.freeze({Start:"Start",Restart:"Restart"}),i={};function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.structuredClone=function(t){return JSON.parse(JSON.stringify(t))};var n=function(){var t,e;function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.initialState,i=t.startTilesAmount,r=void 0===i?s.START_TILES_QUANTITY_DEFAULT:i,n=t.forcePowerOfTwo;if(!(this instanceof s))throw TypeError("Cannot call a class as a function");a(this,"_status",s.STATUS.Idle),a(this,"_score",0),a(this,"_state",void 0);var o=s.sanitizeState((void 0===e?null:e)||structuredClone(s.DEFAULT_BOARD),void 0!==n&&n);this._state=o,this.initialState=structuredClone(o),this.startTilesAmount=r}return t=[{key:"start",value:function(){this._status=s.STATUS.Playing;for(var t=0;t<this.startTilesAmount;t++)this.placeNewTile()}},{key:"restart",value:function(){this._state=structuredClone(this.initialState),this._status=s.STATUS.Idle,this._score=0}},{key:"size",get:function(){return this._state.length}},{key:"getScore",value:function(){return this._score}},{key:"getState",value:function(){return this._state}},{key:"getStatus",value:function(){return this._status}},{key:"move",value:function(t){if(this._status===s.STATUS.Playing)switch(t){case"ArrowUp":this.moveUp();break;case"ArrowRight":this.moveRight();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft()}}},{key:"handleMove",value:function(){if(this._status===s.STATUS.Playing){for(var t=structuredClone(this._state),e=0;e<this.size;e++){for(var i=[],r=0;r<this.size;r++)0!==this._state[r][e]&&i.push(this._state[r][e]);for(var a=[],n=0;n<i.length;)if(n+1<i.length&&i[n]===i[n+1]){var o=2*i[n];a.push(o),this._score+=o,n+=2}else a.push(i[n]),n++;for(;a.length<this.size;)a.push(0);for(var u=0;u<this.size;u++)this._state[u][e]=a[u]}this._state.some(function(e,s){return e.some(function(e,i){return e!==t[s][i]})})&&this.placeNewTile(),this.updateGameStatus()}}},{key:"moveUp",value:function(){this.handleMove()}},{key:"moveDown",value:function(){this.reverseGrid(),this.handleMove(),this.reverseGrid()}},{key:"moveLeft",value:function(){this.rotateClockwise(),this.handleMove(),this.rotateCounterClockwise()}},{key:"moveRight",value:function(){this.rotateCounterClockwise(),this.handleMove(),this.rotateClockwise()}},{key:"reverseGrid",value:function(){this._state.reverse()}},{key:"transpose",value:function(){for(var t,e=0;e<this.size;e++)for(var s=e+1;s<this.size;s++)t=[this._state[s][e],this._state[e][s]],this._state[e][s]=t[0],this._state[s][e]=t[1]}},{key:"rotateClockwise",value:function(){this.transpose(),this._state.forEach(function(t){return t.reverse()})}},{key:"rotateCounterClockwise",value:function(){this._state.forEach(function(t){return t.reverse()}),this.transpose()}},{key:"updateGameStatus",value:function(){if(!this.checkMovePossibility()){this._status=s.STATUS.Lost;return}this._state.some(function(t){return t.includes(2048)})&&(this._status=s.STATUS.Won)}},{key:"getTwoOrFour",value:function(){return .9>Math.random()?2:4}},{key:"placeNewTile",value:function(){for(var t=[],e=0;e<this.size;e++)for(var s=0;s<this.size;s++)0===this._state[e][s]&&t.push({row:e,col:s});if(t.length>0){var i=Math.floor(Math.random()*t.length),r=t[i],a=r.row,n=r.col;this._state[a][n]=this.getTwoOrFour()}}},{key:"checkMovePossibility",value:function(){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++){var s=this._state[t][e];if(!s||e<this.size-1&&this._state[t][e+1]===s||t<this.size-1&&this._state[t+1][e]===s)return!0}return!1}}],e=[{key:"sanitizeState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=function(t){return e?t<=0?0:Math.pow(2,Math.floor(Math.log2(t))):t>0&&(t&t-1)==0?t:0};return t.map(function(t){return t.map(s)})}}],t&&r(s.prototype,t),e&&r(s,e),s}();a(n,"START_TILES_QUANTITY_DEFAULT",2),a(n,"DEFAULT_BOARD",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),a(n,"MOVE_KEYS",Object.freeze(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"])),a(n,"STATUS",Object.freeze({Idle:"idle",Playing:"playing",Lost:"lose",Won:"win"}));var o=new(i=n)({initialState:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}),u=document.querySelector(".container"),l=u.querySelector(".controls button"),c=u.querySelector(".controls .info"),h=u.querySelector(".controls .game-score"),f=u.querySelector(".game-field tbody"),v=u.querySelector(".message-start"),d=u.querySelector(".message-win"),S=u.querySelector(".message-lose");function T(){h.textContent=o.getScore(),function(){for(var t=o.getState(),e=f.rows.length,s=f.rows[0].cells.length,i=0;i<e;i++)for(var r=0;r<s;r++){var a=f.rows[i].cells[r],n=t[i][r];a.textContent=n||"",a.className="field-cell ".concat(n?"field-cell--".concat(n):"")}}(),function(){var t=o.getStatus(),r=t===i.STATUS.Idle;switch(v.classList.add(e.Hidden),d.classList.add(e.Hidden),S.classList.add(e.Hidden),l.classList.remove(e.Restart,e.Start),l.classList.add(r?e.Start:e.Restart),l.textContent=r?s.Start:s.Restart,t){case i.STATUS.Idle:v.classList.remove(e.Hidden);break;case i.STATUS.Won:d.classList.remove(e.Hidden);break;case i.STATUS.Lost:S.classList.remove(e.Hidden)}}()}document.addEventListener("keydown",function(t){var e=o.getStatus();i.MOVE_KEYS.includes(t.key)&&(t.preventDefault(),e===i.STATUS.Playing&&(o.move(t.key),T()))}),l.addEventListener("click",function(){o.getStatus()===i.STATUS.Idle?o.start():o.restart(),T()}),c.addEventListener("click",function(){console.log(o.getState())}),T()}();
//# sourceMappingURL=2048.9ab0b50e.js.map
