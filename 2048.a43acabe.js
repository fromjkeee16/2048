var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};const e=Object.freeze({Start:"start",Restart:"restart",Hidden:"hidden",ActionButton:"button"}),s=Object.freeze({Start:"Start",Restart:"Restart"});var i={};t.structuredClone=t=>JSON.parse(JSON.stringify(t));class r{static START_TILES_QUANTITY_DEFAULT=2;static DEFAULT_BOARD=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];static MOVE_KEYS=Object.freeze(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]);static STATUS=Object.freeze({Idle:"idle",Playing:"playing",Lost:"lose",Won:"win"});_status=r.STATUS.Idle;_score=0;_state;constructor({initialState:t=null,startTilesAmount:e=r.START_TILES_QUANTITY_DEFAULT,forcePowerOfTwo:s=!1}={}){let i=r.sanitizeState(t||structuredClone(r.DEFAULT_BOARD),s);this._state=i,this.initialState=structuredClone(i),this.startTilesAmount=e}start(){this._status=r.STATUS.Playing;for(let t=0;t<this.startTilesAmount;t++)this.placeNewTile()}restart(){this._state=structuredClone(this.initialState),this._status=r.STATUS.Idle,this._score=0}get size(){return this._state.length}getScore(){return this._score}getState(){return this._state}getStatus(){return this._status}move(t){if(this._status===r.STATUS.Playing)switch(t){case"ArrowUp":this.moveUp();break;case"ArrowRight":this.moveRight();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft()}}handleMove(){if(this._status!==r.STATUS.Playing)return;let t=structuredClone(this._state);for(let t=0;t<this.size;t++){let e=[];for(let s=0;s<this.size;s++)0!==this._state[s][t]&&e.push(this._state[s][t]);let s=[],i=0;for(;i<e.length;)if(i+1<e.length&&e[i]===e[i+1]){let t=2*e[i];s.push(t),this._score+=t,i+=2}else s.push(e[i]),i++;for(;s.length<this.size;)s.push(0);for(let e=0;e<this.size;e++)this._state[e][t]=s[e]}this._state.some((e,s)=>e.some((e,i)=>e!==t[s][i]))&&this.placeNewTile(),this.updateGameStatus()}moveUp(){this.handleMove()}moveDown(){this.reverseGrid(),this.handleMove(),this.reverseGrid()}moveLeft(){this.rotateClockwise(),this.handleMove(),this.rotateCounterClockwise()}moveRight(){this.rotateCounterClockwise(),this.handleMove(),this.rotateClockwise()}reverseGrid(){this._state.reverse()}transpose(){for(let t=0;t<this.size;t++)for(let e=t+1;e<this.size;e++)[this._state[t][e],this._state[e][t]]=[this._state[e][t],this._state[t][e]]}rotateClockwise(){this.transpose(),this._state.forEach(t=>t.reverse())}rotateCounterClockwise(){this._state.forEach(t=>t.reverse()),this.transpose()}updateGameStatus(){if(!this.checkMovePossibility()){this._status=r.STATUS.Lost;return}this._state.some(t=>t.includes(2048))&&(this._status=r.STATUS.Won)}static sanitizeState(t,e=!1){let s=t=>t>0&&(t&t-1)==0,i=t=>t<=0?0:Math.pow(2,Math.floor(Math.log2(t))),r=t=>e?i(t):s(t)?t:0;return t.map(t=>t.map(r))}getTwoOrFour(){return .9>Math.random()?2:4}placeNewTile(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0===this._state[e][s]&&t.push({row:e,col:s});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:s,col:i}=t[e];this._state[s][i]=this.getTwoOrFour()}}checkMovePossibility(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let s=this._state[t][e];if(!s||e<this.size-1&&this._state[t][e+1]===s||t<this.size-1&&this._state[t+1][e]===s)return!0}return!1}}const o=new(i=r)({initialState:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}),a=document.querySelector(".container"),l=a.querySelector(".controls button"),n=a.querySelector(".controls .info"),h=a.querySelector(".controls .game-score"),c=a.querySelector(".game-field tbody"),u=a.querySelector(".message-start"),d=a.querySelector(".message-win"),S=a.querySelector(".message-lose");function f(){h.textContent=o.getScore(),function(){let t=o.getState(),e=c.rows.length,s=c.rows[0].cells.length;for(let i=0;i<e;i++)for(let e=0;e<s;e++){let s=c.rows[i].cells[e],r=t[i][e];s.textContent=r||"",s.className=`field-cell ${r?`field-cell--${r}`:""}`}}(),function(){let t=o.getStatus(),r=t===i.STATUS.Idle;switch(u.classList.add(e.Hidden),d.classList.add(e.Hidden),S.classList.add(e.Hidden),l.classList.remove(e.Restart,e.Start),l.classList.add(r?e.Start:e.Restart),l.textContent=r?s.Start:s.Restart,t){case i.STATUS.Idle:u.classList.remove(e.Hidden);break;case i.STATUS.Won:d.classList.remove(e.Hidden);break;case i.STATUS.Lost:S.classList.remove(e.Hidden)}}()}document.addEventListener("keydown",t=>{let e=o.getStatus();i.MOVE_KEYS.includes(t.key)&&(t.preventDefault(),e===i.STATUS.Playing&&(o.move(t.key),f()))}),l.addEventListener("click",()=>{o.getStatus()===i.STATUS.Idle?o.start():o.restart(),f()}),n.addEventListener("click",()=>{console.log(o.getState())}),f();
//# sourceMappingURL=2048.a43acabe.js.map
